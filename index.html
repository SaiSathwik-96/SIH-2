<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HyderabadTransit</title>
    <link rel="stylesheet" href="index.css">
    <!-- Leaflet.js CDN -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
    <header class="main-header">
        <div class="container header-flex">
            <div class="header-left">
                <img src="https://img.icons8.com/ios-filled/50/ffffff/bus.png" alt="Bus Icon" class="logo">
                <h1>HyderabadTransit</h1>
            </div>
            <div class="header-right">
                <button id="toggle-bandwidth" title="Low Bandwidth Mode">Low Data</button>
                <div class="dropdown">
                    <button id="loginDropdownBtn">Login ▼</button>
                    <div id="loginDropdownMenu">
                        <a href="admin-signin.html">Admin Login</a>
                        <a href="driver-signin.html">Driver Sign In</a>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <main>
        <section class="hero-section">
            <div class="container">
                <h2>Real-time Bus Tracking</h2>
                <div class="status-row">
                    <span class="status-dot connected"></span>
                    <span class="status-text">Connected</span>
                </div>
                <!-- Mapbox token input removed: map loads automatically -->
            </div>
        </section>
        <section class="map-section">
            <div class="container">
                <div id="map" style="width:50vw;height:320px;border-radius:12px;"></div>
            </div>
        </section>
        <section class="planner-section">
            <div class="container">
                <div class="planner-header">
                    <img src="https://img.icons8.com/ios-filled/24/4e73df/route.png" alt="Route Icon">
                    <h2>Route Planner</h2>
                </div>
                <form class="route-search-bar" id="route-search-form" autocomplete="off">
                    <div style="position:relative;">
                        <input type="text" id="pickup-location" name="pickup" placeholder="Pickup Location" required autocomplete="off" />
                        <div id="pickup-suggestions" class="autocomplete-suggestions" style="position:absolute;top:100%;left:0;width:100%;background:#fff;z-index:10;box-shadow:0 2px 8px rgba(0,0,0,0.08);display:none;"></div>
                    </div>
                    <span class="swap-icon" title="Swap locations">⇄</span>
                    <div style="position:relative;">
                        <input type="text" id="destination-location" name="destination" placeholder="Destination Location" required autocomplete="off" />
                        <div id="destination-suggestions" class="autocomplete-suggestions" style="position:absolute;top:100%;left:0;width:100%;background:#fff;z-index:10;box-shadow:0 2px 8px rgba(0,0,0,0.08);display:none;"></div>
                    </div>
                    <button type="submit" class="find-routes-btn">Find Route</button>
                </form>
            </div>
        </section>
        <section class="nearby-stops-section">
            <div class="container">
                <h2>Nearby Stops</h2>
                <div class="stops-list"></div>
            </div>
        </section>
        <section class="notification-section" style="display:none;" id="notification-section">
            <div class="container">
                <div id="notification-message" style="background:#fff3cd;color:#856404;padding:0.7rem 1rem;border-radius:8px;margin:1rem 0;"></div>
            </div>
        </section>
        <section class="feedback-section">
            <div class="container">
                <h2>Feedback & Reporting</h2>
                <form id="feedback-form" style="display:flex;flex-direction:column;gap:0.7rem;max-width:400px;">
                    <textarea id="feedback-text" rows="3" placeholder="Describe your issue or suggestion..." required></textarea>
                    <input type="text" id="feedback-contact" placeholder="Your email or phone (optional)">
                    <button type="submit" style="background:#4e73df;color:#fff;border:none;padding:0.5rem 1.2rem;border-radius:5px;">Submit Feedback</button>
                </form>
                <div id="feedback-success" style="color:#1cc88a;margin-top:0.5rem;display:none;">Thank you for your feedback!</div>
            </div>
        </section>
    </main>
    <footer>
        <div class="container">
            <p>Powered by Road Transport Corporation (TSRTC)</p>
            <p>Real-time data updated every 30 seconds • Covering Greater Hyderabad</p>
        </div>
    </footer>
    <script src="script.js"></script>
    <script>
    // --- Autocomplete for pickup and destination using Nominatim API ---
    function setupAutocomplete(inputId, suggestionsId) {
        const input = document.getElementById(inputId);
        const suggestions = document.getElementById(suggestionsId);
        let debounceTimeout;
        input.addEventListener('input', function() {
            clearTimeout(debounceTimeout);
            const query = input.value.trim();
            if (query.length < 2) {
                suggestions.style.display = 'none';
                return;
            }
            debounceTimeout = setTimeout(() => {
                fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}`)
                    .then(res => res.json())
                    .then(data => {
                        suggestions.innerHTML = '';
                        if (data.length === 0) {
                            suggestions.style.display = 'none';
                            return;
                        }
                        data.slice(0, 6).forEach(place => {
                            const div = document.createElement('div');
                            div.textContent = place.display_name;
                            div.style.padding = '0.5rem 1rem';
                            div.style.cursor = 'pointer';
                            div.addEventListener('mousedown', function(e) {
                                e.preventDefault();
                                input.value = place.display_name;
                                suggestions.style.display = 'none';
                            });
                            suggestions.appendChild(div);
                        });
                        suggestions.style.display = 'block';
                    });
            }, 250);
        });
        // Hide suggestions on blur
        input.addEventListener('blur', function() {
            setTimeout(() => { suggestions.style.display = 'none'; }, 100);
        });
    }
    setupAutocomplete('pickup-location', 'pickup-suggestions');
    setupAutocomplete('destination-location', 'destination-suggestions');
    </script>
    <script>

                // Driver info is not shown on the user page

                // Login dropdown
        const loginBtn = document.getElementById('loginDropdownBtn');
        const loginMenu = document.getElementById('loginDropdownMenu');
        loginBtn.onclick = function(e) {
            e.stopPropagation();
            loginMenu.style.display = loginMenu.style.display === 'block' ? 'none' : 'block';
        };
        document.body.addEventListener('click', function() {
            loginMenu.style.display = 'none';
        });

        // Language selector (placeholder)
    document.getElementById('language-select').addEventListener('change', function() {
        showNotification('Language changed to: ' + this.options[this.selectedIndex].text);
    });
    // High contrast toggle
    document.getElementById('toggle-contrast').addEventListener('click', function() {
        document.body.classList.toggle('high-contrast');
        showNotification(document.body.classList.contains('high-contrast') ? 'High contrast mode enabled' : 'High contrast mode disabled');
    });
    // Low bandwidth toggle (text-only mode placeholder)
    document.getElementById('toggle-bandwidth').addEventListener('click', function() {
        document.body.classList.toggle('low-bandwidth');
        showNotification(document.body.classList.contains('low-bandwidth') ? 'Low bandwidth mode enabled' : 'Low bandwidth mode disabled');
    });
    // Notification UI
    function showNotification(msg) {
        var section = document.getElementById('notification-section');
        var msgDiv = document.getElementById('notification-message');
        msgDiv.textContent = msg;
        section.style.display = 'block';
        setTimeout(function(){ section.style.display = 'none'; }, 2500);
    }
    // Feedback form
    document.getElementById('feedback-form').addEventListener('submit', function(e) {
        e.preventDefault();
        document.getElementById('feedback-success').style.display = 'block';
        setTimeout(function(){ document.getElementById('feedback-success').style.display = 'none'; }, 3000);
        this.reset();
    });
    </script>
</body>
</html>
